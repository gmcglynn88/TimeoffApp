<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Time by IPI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Proxima+Nova:wght@400;700&display=swap">
    <style>
        body {
            font-family: 'Proxima Nova', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-color: #63AB8F; /* Custom Teal */
            color: white;
            position: relative;
        }

        header h1 {
            margin: 0;
        }

        .logo {
            height: 50px;
            position: absolute;
            right: 20px;
        }

        .tab {
            overflow: hidden;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ddd;
        }

        .tab button {
            background-color: inherit;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #63AB8F;
            color: white;
        }

        .tabcontent {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .tabcontent table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .tabcontent table, th, td {
            border: 1px solid #ddd;
        }

        .tabcontent th {
            background-color: #63AB8F; /* Custom Teal */
            color: white;
        }

        .tabcontent th, .tabcontent td {
            padding: 10px;
            text-align: left;
        }

        .tabcontent label {
            display: block;
            margin-top: 10px;
        }

        .tabcontent select, .tabcontent textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .tabcontent textarea {
            height: 100px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Your Time by IPI</h1>
        <img src="https://gmcglynn88.github.io/TimeoffApp/IPI%20SandE%20Transparent.png" alt="IPI Success & Enablement Logo" class="logo">
    </header>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'ConfigurationRequirements')" id="defaultOpen">Configuration Requirements</button>
        <button class="tablinks" onclick="openTab(event, 'TimeOffBalances')">Time Off Balances</button>
    </div>

    <div id="ConfigurationRequirements" class="tabcontent">
        <h3>Configuration Requirements</h3>
        <label for="holiday-year">Holiday Year:</label>
        <select id="holiday-year">
            <option value="2024">2024</option>
            <option value="2025">2025</option>
        </select>
        
        <label for="time-off-codes">Please list WFM time off codes to be included: (These should be agent selectable codes ONLY)</label>
        <textarea id="time-off-codes"></textarea>
        
        <label for="bus">Please list BU's to enable on:</label>
        <textarea id="bus"></textarea>
        
        <label for="data-tables-required">Are separate Data tables required for the above BU's?</label>
        <select id="data-tables-required">
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select>
        
        <label for="num-tables">If Yes, how many tables are required, please list:</label>
        <textarea id="num-tables"></textarea>
    </div>

    <div id="TimeOffBalances" class="tabcontent">
        <h3>Select Agent</h3>
        <select id="agent-select">
            <!-- Options will be populated dynamically -->
        </select>
        
        <h3>Time off Balances</h3>
        <table>
            <thead>
                <tr>
                    <th>Agent Name</th>
                    <th>Team</th>
                    <th>Management Unit</th>
                    <th>Holiday (Current Year)</th>
                    <th>Holiday (Next Year)</th>
                    <th>Time off In Lieu</th>
                </tr>
            </thead>
            <tbody id="balances-table-body">
                <!-- Data rows go here -->
            </tbody>
        </table>

        <h3>Time off Details</h3>
        <table>
            <thead>
                <tr>
                    <th>Agent Name</th>
                    <th>Team</th>
                    <th>Management Unit</th>
                    <th>Time off Start</th>
                    <th>Time off End</th>
                    <th>Balance Deduction (Hrs)</th>
                </tr>
            </thead>
            <tbody id="details-table-body">
                <!-- Data rows go here -->
            </tbody>
        </table>
    </div>

    <!-- Include Genesys Cloud JavaScript SDK -->
    <script src="https://sdk-cdn.mypurecloud.com/javascript-sdk/58.0.0/purecloud-platform-client-v2.min.js"></script>
    <script>
        // Initialize Genesys Cloud SDK
        const platformClient = require('platformClient');
        const client = platformClient.ApiClient.instance;
        
        // Set the environment
        client.setEnvironment('mypurecloud.ie');

        // Authenticate using Client Credentials
        const clientId = 'YOUR_CLIENT_ID';
        const clientSecret = 'YOUR_CLIENT_SECRET';

        async function authenticate() {
            try {
                const data = await client.loginClientCredentialsGrant(clientId, clientSecret);
                console.log('Authenticated:', data);
                await populateDropdown();
                await populateTable();
            } catch (error) {
                console.error('Error during authentication:', error);
            }
        }

        async function fetchDataTableRows() {
            const routingApi = new platformClient.RoutingApi();

            try {
                const data = await routingApi.getRoutingDatatableRow('3bcf89ba-8aed-4fdb-b143-a726c3887a27', {
                    pageSize: 100, // Adjust the page size as needed
                    pageNumber: 1
                });
                console.log('Data table rows:', data);
                return data.entities;
            } catch (error) {
                console.error('Error fetching data table rows:', error);
                return [];
            }
        }

        // Populate the dropdown with agent names
        async function populateDropdown() {
            const rows = await fetchDataTableRows();
            const agentSelect = document.getElementById('agent-select');
            
            // Clear existing options
            agentSelect.innerHTML = '';

            // Populate the dropdown with fetched data
            rows.forEach(row => {
                const option = document.createElement('option');
                option.value = row.Name;
                option.textContent = row.Name;
                agentSelect.appendChild(option);
            });
        }

        // Call fetchDataTableRows and populate the HTML table
        async function populateTable() {
            const rows = await fetchDataTableRows();
            const balancesTableBody = document.getElementById('balances-table-body');
            
            // Clear existing rows
            balancesTableBody.innerHTML = '';

            // Populate the table with fetched data
            rows.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.agentName}</td>
                    <td>${row.team}</td>
                    <td>${row.managementUnit}</td>
                    <td><input type="text" value="${row.holidayCurrentYear}"></td>
                    <td><input type="text" value="${row.holidayNextYear}"></td>
                    <td><input type="text" value="${row.timeOffInLieu}"></td>
                `;
                balancesTableBody.appendChild(tr);
            });
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        document.getElementById("defaultOpen").click();

        document.addEventListener('DOMContentLoaded', authenticate);
    </script>
</body>
</html>
